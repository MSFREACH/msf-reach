<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Events &middot; MSF REACH</title>

  <!-- favicons -->
  <link rel="icon" type="image/png" href="/resources/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/resources/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/resources/images/favicons/favicon-96x96.png" sizes="96x96">

  <!-- Bootstrap -->
  <link href="/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/lib/bootstrap/plugins/datetimepicker/bootstrap-datetimepicker.min.css">
  <link href="/resources/css/flexText.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Leaflet -->
  <link rel="stylesheet" href="/lib/leaflet/leaflet.css"/>

  <!-- Leaflet groups -->
  <link rel="stylesheet" href="/lib/leaflet/leaflet.groupedlayercontrol.min.css"/>


  <!-- Leaflet -->
  <link rel="stylesheet" href="/lib/leaflet/MarkerCluster.css"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="/lib/leaflet/MarkerCluster.Default.css"/>

  <!-- Leaflet rrose popup fix -->
  <link rel="stylesheet" href="/lib/leaflet/leaflet.rrose.css"/>


  <!-- Copy to clipboard functionality -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>

  <!-- Events -->
  <link rel="stylesheet" href="/resources/css/events.css"/>


  <!-- Nav -->
  <link rel="stylesheet" href="/resources/css/nav.css"/>

  <!-- country selector -->
  <link rel="stylesheet" href="/resources/css/countrySelect.min.css">

  <!-- jqueryui css -->
  <link rel="stylesheet" href="/resources/css/jquery-ui-1.12.1.min.css">

  <style type="text/css">
  .page-header {
    margin-top: 20px;
  }
  .form-group {
    margin-bottom: 0;
  }
  dl {
    margin-bottom: 10px;
  }

  dl dt, .form-group label {
    text-transform: uppercase;
    font-size: 13px;
  }

  .bg-success {
    padding: 5px;
  }
  </style>
</head>
<body>

  <!-- Operator access modal -->
  <div class="modal fade" id="operatorAccessModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabelOperator">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabelOperator">Operator access</h4>
        </div>
        <div class="modal-body" id="OperatorModalBody">
          <p>You do not have the permission, please contact <a href="mailto:lucie.gueuning@hongkong.msf.org">us</a> for edit access.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <!-- report creation modal -->
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myNewReportModalLabel" id="newReportModal">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myNewRpoertModalLabel">Create New Report</h4>
        </div>
        <div class="modal-body">
          <div style="">
            <div class="form-section">
              <h4>Hello!</h4>
              <p>MSF would like to request any information you may have about an event that may be happening in your area.</p>
              <p>We are piloting a new system for sharing information. Please follow the instructions to submit your report.</p>
              <p>THANK YOU for being part of our team! </p>
              <p>Our promise to protect your privacy: Médecins Sans Frontières Hong Kong (MSF) promise not to sell, share or swap your personal information with any other company/ organisation. The information you provide will be treated as strictly confidential and used in accordance to our Privacy Policy, found on <a href="http://msf-seasia.org">our website</a>.</p>
            </div>
            <div class="form-section">
              <h5>1. Please select the location of your information on the map:</h5>
              <div class="form-group">
                <input type="text" class="form-control input-sm" placeholder="Search address/location..." id="mapAddress">
              </div>
              <div class="row bottom-margined">
                <div class="col-sm-1">
                  <label for="mapAddressLat">OR:</label>
                </div>
                <div class="col-sm-4">
                  <input type="text" class="form-control input-sm" value="" id="mapAddressLat" placeholder="Latitude">
                </div>
                <div class="col-sm-4">
                  <input type="text" class="form-control input-sm" value="" id="mapAddressLng" placeholder="Longitude">
                </div>
                <div class="col-sm-2">
                  <button type="button" class="btn btn-info btn-sm" id="mapAddressLocate"><span class="glyphicon glyphicon-search"></span></button>
                </div>
              </div>
              <div id="newReportMap"></div>
            </div>
            <div class="form-section">
              <h5>2. Please help us best assess the situation by helping us sort your report.</h5>
              <div class="rtype-container">
                <div class="rtype-item" data-msf-value="ACCESS">ACCESS<br><i>Location / Damage</i></div>
                <div class="rtype-item"  data-msf-value="NEEDS">NEEDS<br><i>Population / Medical</i></div>
                <div class="rtype-item"  data-msf-value="CONTACTS">CONTACTS<br><i>Details / Relevance</i></div>
                <div class="rtype-item" data-msf-value="SECURITY">SECURITY<br><i>Incident / Caution</i></div>
              </div>
              <p>Please select one category. There is an opportunity to submit another report card for another category after submission of this one.</p>
            </div>
            <div class="form-section">
              <h5>3. Please enter text in the box below to share your information.</h5>
              <textarea rows="12" maxlength="150" placeholder="Free text (150 characters)..." class ="form-control" id="inputReportText" ></textarea>
              <i> Optional</i>
              <input placeholder="name..." class="form-control" id="inputReportUserName">
            </div>
            <div class="form-section">
              <h5>4. Would you like to upload an image ? </h5><i>(optional)</i>
              <form enctype="multipart/form-data">
                <input id="inputImageUpload" type="file" accept="image/*" style="display:none;"/>
                <a id="btnUpTrigger" class="btn btn-default" style="text-transform:uppercase;" >Upload / take photo</a>
                <div style="margin-top:10px;width:100%;height:55vh;border:1px solid black;">
                  <img id="imgPreview" src="" alt="your image" style="width:100%;height:55vh;display:none;"/>
                </div>
              </form>

            </div>
            <div class="form-section">
              <br>
              <div id="divProgress"></div>
              <div id="divSuccess" style="display:none;">
                <h4>Thank you for your report!</h4>
                <br>
                <p>Your information has been successfully sent to MSF-HK. We greatly appreciate your participation and value the information you provided.</p>
                <button onclick="cleanupForNewReport()" class="btn btn-msf">Submit new report</button><br><br>
                <a href="/contact/" target="_blank" class="btn btn-msf">Submit contact details</a>
                <br>
              </div>

            </div>



          </div>

        </div>
        <div class="modal-footer">
          <div class="form-navigation">
            <button type="button" class="previous btn btn-info pull-left">PREVIOUS</button>
            <button type="button" class="next btn btn-danger pull-right">NEXT</button>
            <button type="button" id="createReport" class="btn btn-primary pull-right" style="display: none;">Submit</button>
            <span class="clearfix"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Archive Modal -->
  <div class="modal fade" id="archiveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content" id="archiveEventModalContent">
        <!-- Warning this will be replace by /public/events/archive.html -->
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
        </div>
        <div class="modal-body">
          Archived events will no longer be shown on the MSF Reach Landing Page.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button id="btnArchive" type="button" class="btn btn-danger">Close Event</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content" id="eventModalContent">
        <!-- WARNING: Contents on this modal will be replace with public/events/edit.html -->
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Edit Event</h4>
        </div>
        <div class="modal-body">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Name</h3>
            </div>
            <div class="panel-body">
              <input type="text" id="inputName" class="form-control" placeholder="" aria-describedby="basic-addon1">
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Status</h3>
            </div>
            <div class="panel-body">
              <select class="form-control" id="inputStatus">
                <option value="Monitoring" selected>Monitoring</option>
                <option value="Exploration">Exploration</option>
                <option value="Intervention">Intervention</option>
                <option value="Completed Mission">Completed Mission</option>
              </select>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Security Details</h3>
            </div>
            <div class="panel-body">
              <textarea class="form-control" rows="2" id="inputSecurityDetails" placeholder="" required></textarea>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Latest Notification</h3>
            </div>
            <div class="panel-body">
              <textarea class="form-control" rows="2" id="inputNotification" placeholder="" required></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button id="btnSaveEdits" type="button" class="btn btn-primary">Save Edits</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Contact Page Modal -->
  <div class="modal fade" id="contactDetailsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabelContact">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabelContact">Contact Information</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-xs-6">
              <div class="bg-success">Record History</div>
              <div class="form-group">
                <label>Created on:</label>
                <span class="filed"></span>
            </div>
            <div class="form-group">
              <label>Last updated on:</label>
              <span class="updated"></span>
            </div>
            <div class="form-group" id="privateContactDiv">
              <label>Private?</label>
              <span class="private" id="privateContact"></span>
            </div>
            <div class="form-group" id="shareWithDiv">
              <label>Share with</label>
              <input type="text" id="sharewith_email" name="sharewith_email">
            </div>
          <div class="form-group">
            <label>Last email sent on:</label>
          </span> <span class="last_email"></span>
        </div>
        <div class="bg-success">Personal Details</div>
        <div class="form-group" style="display:none;">
          <label>Name:</label>
          <span class="title"></span> <span class="name"></span>
        </div>
        <div class="form-group" style="display:none;">
          <label>Other names:</label>
          <span class="otherNames"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Date of birth:</label>
          <span class="dob"></span>
        </div>
        <div class="form-group" style="display:none;">
          <label>Gender:</label>
          <span class="gender"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Contact type:</label>
          <span class="type"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Speciality / profile:</label>
          <span class="speciality"></span>
        </div>
        <div class="bg-success">Contact details</div>
        <div class="form-group"  style="display:none;">
          <label>Mobile phone:</label>
          <span class="cell"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Work phone:</label>
          <span class="work"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Home phone:</label>
          <span class="home"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Email:</label>
          <span class="email"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Other email:</label>
          <span class="email2"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Fax:</label>
          <span class="fax"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Web:</label>
          <span class="web"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Address:</label>
          <span class="address"></span>
        </div>
      </div>
      <div class="col-xs-6">
        <div id="msf_details">
          <div class="bg-success">MSF details</div>
          <div class="form-group" style="display:none;">
            <label>OC:</label>
            <span class="OC"></span>
          </div>
          <div class="form-group" style="display:none;">
            <label>Employment status:</label>
            <span class="msf_employment"></span>
          </div>
          <div class="form-group" style="display:none;">
            <label>Section:</label>
            <span class="msf_section"></span>
          </div>
          <div class="form-group" style="display:none;">
            <label>Branch:</label>
            <span class="msf_branch"></span>
          </div>
          <div class="form-group"  style="display:none;">
            <label>Project:</label>
            <span class="msf_project"></span>
          </div>
          <div class="form-group"  style="display:none;">
            <label>Mission:</label>
            <span class="msf_mission"></span>
          </div>
        </div>
        <div id="employment_details">
          <div class="bg-success">Employment details</div>
          <div class="form-group"  style="display:none;">
            <label>Employer / organisation name:</label>
            <span class="employer"></span>
          </div>
          <div class="form-group"  style="display:none;">
            <label>Job title:</label>
            <span class="job_title"></span>
          </div>
          <div class="form-group"  style="display:none;">
            <label>Unit/division:</label>
            <span class="division"></span>
          </div>
          <div class="bg-success">MSF relationship</div>
          <div class="form-group"  style="display:none;">
            <label>MSF associate member:</label>
            <span class="msf_associate"></span>
          </div>
          <div class="form-group"  style="display:none;">
            <label>MSF peer:</label>
            <span class="msf_peer"></span>
          </div>
        </div>

        <div class="bg-success">Social media</div>
        <div class="form-group"  style="display:none;">
          <label>WhatsApp:</label>
          <span class="WhatsApp"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Twitter:</label>
          <span class="Twitter"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Facebook:</label>
          <span class="Facebook"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Telegram:</label>
          <span class="Telegram"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Skype:</label>
          <span class="Skype"></span>
        </div>
        <div class="form-group"  style="display:none;">
          <label>Instagram:</label>
          <span class="Instagram"></span>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
  </div>
</div>
</div>
</div>
<!-- Mission history modal -->
<div class="modal fade" id="missionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabelMession">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabelMession">Mission History Details</h4>
      </div>
      <div class="modal-body" id="missionModalBody">
        [modal content here]
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Page -->
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand"><img src="/resources/images/msf-reach-logo-trans-01.png" style="height:100%;width:auto;" /></a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">SESSION <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#" id="username"></a></li>
            </ul>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="container-fluid">
      <div class="row">
        <!-- Side pane -->
        <div id="sidepane" class="col-md-6" style="min-height:90vh;">
          <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a id="eventTab" data-toggle="tab" href="#event">Event</a></li>
            <li role="presentation"><a id="feedTab" data-toggle="tab" href="#tweets">Twitter Feed</a></li>
            <li role="presentation"><a id="contactsTab" data-toggle="tab" href="#contacts" >Contacts</a></li>
            <li role="presentation"><a id="ongoingEventsTab" data-toggle="tab" href="#ongoingEvents">Ongoing MSF projects</a></li>
            <li role="presentation"><a id="missionsTab" data-toggle="tab" href="#missions">Mission History</a></li>
            <li role="presentation"><a id="reportsTab" data-toggle="tab" href="#reports">Reports</a></li>
            <li role="presentation"><a id="countryDetailsTab" data-toggle="tab" href="#countryDetails">Country Details</a></li>
          </ul>
          <div class="msf-loader"></div>
          <div class="tab-content" id="eventVApp" v-cloak>

            <div id="event" class="tab-pane fade in active">
              <div>
                <table class="table">
                  <tr><td>Name</td><td> {{ event.metadata.name }}</td></tr>
                  <tr><td>Country</td><td> {{ event.metadata.country }}</td></tr>
                  <tr><td>Status</td><td> {{ event.metadata.event_status || 'monitoring' }}</td></tr>
                  <tr><td>Type</td><td> {{ typeStr(event.type,event.metadata.sub_type) }}</td></tr>
                  <tr><td>Event date and Time</td><td> {{ event.metadata.event_datetime || event.created_at }}</td></tr>

                  <tr v-if='event.metadata.notification'><td>Latest notification: </td><td>{{ notStr }}</td></tr>

                  <tr v-else><td>Latest notification:  </td><td>(none)</td></tr>
                  <tr><td>Severity </td><td> <span v-if="event.metadata.severity_scale">scale:  <span :style="'color:'+severityColors[event.metadata.severity_scale-1]">{{severityLongTexts[event.metadata.severity_scale-1]}}</span></span>, description: {{ event.metadata.severity }} </td></tr>
                  <tr><td>Person In charge </td><td> {{ event.metadata.incharge_name+', '+event.metadata.incharge_position }}</td></tr>
                  <tr><td>Sharepoint Link </td><td> {{ event.metadata.sharepoint_link }}</td></tr>
                  <tr><td>Last updated at</td><td> {{ event.updated_at.split('T')[0] }}</td></tr>




                  <tr><td>Event link</td><td><a id='eventLink'  :href='eventLink' target='_blank'>{{ eventLink }}</a></td><td><button class='btn btn-primary' data-clipboard-target='#eventLink'>Copy link</button></td></tr>

                  <tr><td>Report</td><td><button class="btn btn-primary" data-toggle="modal" data-target="#newReportModal">Create a new report</button></td>
                    <td><a style="display:none;" id='reportLink' :href='eventReportLink' target='_blank'> {{ eventReportLink }} </a><button class='btn btn-primary' :data-clipboard-text='eventReportLink'>Copy link</button></td></tr>


                    <tr v-if='event.metadata.user'><td>Creator</td><td> {{ event.metadata.user }}</td></tr>
                    <tr v-if='event.metadata.user_edit'><td>Edits</td><td>{{ event.metadata.user_edit }}</td></tr>
                  </table>


              </div>
              <div class="panel-group" id="accordion">
                <div class="panel panel-default" id="panel4">
                  <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#collapseNotif" >
                      <a data-toggle="collapse" data-target="#collapseNotif"
                      href="#collapseNotif" class="collapsed">
                      Notifications
                      </a>
                    <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('general')">Edit</button>
                  </div>
                  <div id="collapseNotif" class="panel-collapse collapse in">
                    <div class="panel-body" >
                      <div id="eventNotifications">

                            <table v-if="(event.metadata.notification) && (event.metadata.notification.length > 0) " class="table">
                              <thead><tr><td>Time</td><td>Notification</td></tr></thead>
                              <tbody>
                                <tr v-for="elem in event.metadata.notification">
                                  <td>{{ (new Date(elem.notification_time*1000)).toLocaleString() }}</td>
                                  <td> {{ elem.notification }}</td>
                                </tr>
                              </tbody>
                            </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default" >
                  <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#collapseResp" >
                      <a data-toggle="collapse" data-target="#collapseResp"
                      href="#collapseResp" class="collapsed">
                      Response
                      </a>
                    <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('response')">Edit</button>
                  </div>
                  <div id="collapseResp" class="panel-collapse collapse">
                    <div class="panel-body" >
                      <div>
                            <dl class="dl-horizontal">
                              <dt>Type of programmes:</dt>
                              <dd v-for="item in event.metadata.msf_response_types_of_programmes" >
                                <span class="label label-primary" >
                                     {{ getTypeOfProgramme(item) }}
                                </span>&nbsp;
                              </dd>
                              <dt>MSF Response:</dt>
                              <dd>
                                {{event.metadata.msf_response}}
                              </dd>
                              <dt>Start Date:</dt>
                              <dd>
                                {{formatDateOnly(event.metadata.start_date_msf_response)}}
                              </dd>
                              <dt>End Date:</dt>
                              <dd>
                                {{formatDateOnly(event.metadata.end_date_msf_response)}}
                              </dd>
                              <dt>
                                Location of MSF Response:
                              </dt>
                              <dd>
                                <a @click="editEvent('response')">Edit</a>
                              </dd>
                              <dt>Operational Centre:</dt>
                              <dd>
                                {{event.metadata.operational_center}}
                              </dd>
                              <dt>
                                Medical Material:
                              </dt>
                                  <dd v-for="item in event.metadata.msf_response_medical_material">
                                    {{item}}
                                  </dd>
                                  <dd><b>Total:</b> {{event.metadata.msf_response_medical_material_total}}</dd>
                                  <dd><b>Date of Arrival:</b> {{formatDateOnly(event.metadata.msf_response_medical_material_date_arrival)}}</dd>
                              <dt>
                                Non-Medical Material:
                              </dt>
                              <dd v-for="item in event.metadata.msf_response_non_medical_material">
                                {{item}}
                              </dd>
                              <dd><b>Total:</b> {{event.metadata.msf_response_non_medical_material_total}}</dd>
                              <dd><b>Date of Arrival:</b> {{formatDateOnly(event.metadata.msf_response_non_medical_material_date_arrival)}}</dd>


                            </dl>

                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default" >
                  <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#collapseExtCapacity" >
                      <a data-toggle="collapse" data-target="#collapseExtCapacity"
                      href="#collapseExtCapacity" class="collapsed">
                      External Capacity
                      </a>
                    <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('externalcap')">Edit</button>
                  </div>
                  <div id="collapseExtCapacity" class="panel-collapse collapse">
                    <div class="panel-body" >
                      <div>
                            <dl class="dl-horizontal">
                              <dt>Analysis of capacity on the ground:</dt>
                              <dd>{{event.metadata.ext_capacity_type_in_ground =='medical' ? 'Medical' : 'Non-Medical'}}</dd>
                              <dd>{{event.metadata.capacity}}</dd>
                              <dd>{{event.metadata.ext_capacity_by_humanitarian}}</dd>
                              <dd>{{event.metadata.ext_capacity_action_plan}}</dd>
                              <dd>{{event.metadata.ext_capacity_who}}</dd>
                              <dt>Other organizations:</dt>
                              <section v-for="(item, index) in event.metadata.ext_other_organizations">
                                <dd>{{item.name + ' - ' + item.deployment + ' - '+ formatDateOnly(item.arrival_date) }}</dd>
                              </section>

                            </dl>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="panel panel-default" >
                      <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#medFigures" >
                        <a data-toggle="collapse" data-target="#medFigures"
                        href="#medFigures" class="collapsed">
                        Medical Figures
                      </a>
                      <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('medfigures')">Edit</button>
                    </div>
                    <div id="medFigures" class="panel-collapse collapse">
                      <div class="panel-body" >
                        <div>
                          <dl class="dl-horizontal">
                            <dt>Figures:</dt>
                            <dd v-for="(item, index) in event.metadata.keyMSFFigures">{{item.category.replace(/_/g,' ') }} , <i>value:</i> {{item.value}}</dd>
                            <dt>Population in total for zone impacted:</dt>
                            <dd>{{event.metadata.population_total}}</dd>
                            <dt>Description:</dt>
                            <dd>{{event.metadata.population_total_description}}</dd>
                            <dt>Population affected:</dt>
                            <dd>{{event.metadata.population_affected}}</dd>
                            <dt>Description:</dt>
                            <dd>{{event.metadata.population_affected_description}}</dd>
                            <dt>Percentage of people affected:</dt>
                            <dd>{{event.metadata.percentage_population_affected}}</dd>
                          </dl>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default" >
                    <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#resourceCollapse" >
                      <a data-toggle="collapse" data-target="#resourceCollapse" href="#resourceCollapse" class="collapsed">
                      Staff Resources
                    </a>
                    <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('resources')">Edit</button>
                  </div>
                  <div id="resourceCollapse" class="panel-collapse collapse">
                    <div class="panel-body" >
                      <div>
                        <dl class="dl-horizontal">
                          <dt>Staff list — human resources:</dt>
                          <dd>{{event.metadata.msf_resource_staff_list}}</dd>
                          <dt>Expatriate:</dt>
                          <dd>{{event.metadata.msf_resource_staff_expatriate}}</dd>
                          <dt>National staff:</dt>
                          <dd>{{event.metadata.msf_resource_staff_national}}</dd>
                          <dt>Visa requirement:</dt>
                          <dd v-for="item in event.metadata.msf_resource_visa_requirement.nationality"><span v-if="item.name"> {{item.name}} , <i>required:</i> {{item.is_required}} </span><span v-else>No</span></dd>
                          <dt>Description:</dt>
                          <dd>{{event.metadata.msf_resource_visa_requirement.description}}</dd>
                          <dt>Budget:</dt>
                          <dd v-for="(item, index) in event.metadata.msf_resource_budget"><span v-if="(item.from_who) || (item.amount>0)" ><i>Amount:</i>{{item.amount}}, <i>From:</i>{{item.from_who}}</span><span v-else></span> </dd>
                          <dt>Institutional Donors:</dt>
                          <dd>{{event.metadata.msf_resource_institutional_donors}}</dd>
                        </dl>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default" >
                  <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#reflectionCollapse" >
                    <a data-toggle="collapse" data-target="#reflectionCollapse"
                    href="#reflectionCollapse" class="collapsed">
                    Reflection
                  </a>
                  <button type="button" class="btn btn-info btn-xs pull-right" @click="editEvent('reflection')">Edit</button>
                </div>
                <div id="reflectionCollapse" class="panel-collapse collapse">
                  <div class="panel-body" >
                    <div>
                      <dl class="dl-horizontal">
                        <dt>Practical Details / Recommendations:</dt>
                        <dd>{{event.metadata.msf_ref_com_practical_details_recomm}}</dd>
                        <dt>Reflection / Comments on intervention:</dt>
                        <dd>{{event.metadata.msf_ref_com_reflection_comments}}</dd>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>



              <div class="panel panel-default" id="panel3">
                <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#collapseThree">
                  <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapseThree"
                    href="#collapseThree" class="collapsed">
                    Security Details
                  </details>
                </a>
              </h4>

            </div>
            <div id="collapseThree" class="panel-collapse collapse">
              <div class="panel-body" id="eventSecurityDetails"></div>
            </div>
          </div>

          <div class="panel panel-default" id="panel5">
            <div class="panel-heading" style="cursor:pointer;" data-toggle="collapse" data-target="#collapseFour">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-target="#collapseFour"
                href="#collapseFour" class="collapsed">
                Extra details
                </a>
              </h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse">
              <div class="panel-body" >
                <dl id="eventExtra" class="dl-horizontal">

                </dl>
              </div>
            </div>
          </div>
      </div>
      <button class="btn btn-primary"  @click="editEvent('general')">Edit</button>
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#archiveModal" onclick="onArchiveEvent()">Close</button>
    </div>
    <div id="tweets" class="tab-pane fade">
      <div class="row">
        <div class="col-md-5" style="height:80vh;overflow-y:auto;" >
          <h4>Twitter Feed</h4>
          <div class="input-group add-on">
            <input  class="form-control" placeholder="Search e.g. #earthquake" name="srch-term" id="searchTerm" type="text">
            <div class="input-group-btn">
              <button id="btnSearchTwitter" class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
            </div>
          </div>
          <div id="translationSuggestedLanguages">Suggested languages (based on country, if in SE Asia): </div>
          <div>
          <select class="goog-te-combo" id="translateLanguageSelection">
            <option value="">Select Language</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
            <option value="am">Amharic</option>
            <option value="ar">Arabic</option>
            <option value="hy">Armenian</option>
            <option value="az">Azerbaijani</option>
            <option value="eu">Basque</option>
            <option value="be">Belarusian</option>
            <option value="bn">Bengali</option>
            <option value="bg">Bulgarian</option>
            <option value="my">Burmese</option>
            <option value="ca">Catalan</option>
            <option value="ceb">Cebuano</option>
            <option value="ny">Chichewa</option>
            <option value="zh-CN">Chinese (Simplified)</option>
            <option value="zh-TW">Chinese (Traditional)</option>
            <option value="co">Corsican</option>
            <option value="hr">Croatian</option>
            <option value="cs">Czech</option>
            <option value="da">Danish</option>
            <option value="nl">Dutch</option>
            <option value="en">English</option>
            <option value="eo">Esperanto</option>
            <option value="et">Estonian</option>
            <option value="tl">Filipino</option>
            <option value="fi">Finnish</option>
            <option value="fr">French</option>
            <option value="fy">Frisian</option>
            <option value="gl">Galician</option>
            <option value="ka">Georgian</option>
            <option value="de">German</option>
            <option value="el">Greek</option>
            <option value="gu">Gujarati</option>
            <option value="ht">Haitian Creole</option>
            <option value="ha">Hausa</option>
            <option value="haw">Hawaiian</option>
            <option value="iw">Hebrew</option>
            <option value="hi">Hindi</option>
            <option value="hmn">Hmong</option>
            <option value="hu">Hungarian</option>
            <option value="is">Icelandic</option>
            <option value="ig">Igbo</option>
            <option value="id">Indonesian</option>
            <option value="ga">Irish</option>
            <option value="it">Italian</option>
            <option value="id">Indonesian</option>
            <option value="ja">Japanese</option>
            <option value="jw">Javanese</option>
            <option value="kn">Kannada</option>
            <option value="kk">Kazakh</option>
            <option value="km">Khmer</option>
            <option value="ko">Korean</option>
            <option value="ku">Kurdish</option>
            <option value="ky">Kyrgyz</option>
            <option value="lo">Lao</option>
            <option value="la">Latin</option>
            <option value="lv">Latvian</option>
            <option value="lt">Lithuanian</option>
            <option value="lb">Luxembourgish</option>
            <option value="mk">Macedonian</option>
            <option value="mg">Malagasy</option>
            <option value="ms">Malay</option>
            <option value="ml">Malayalam</option>
            <option value="mt">Maltese</option>
            <option value="mi">Maori</option>
            <option value="mr">Marathi</option>
            <option value="mn">Mongolian</option>
            <option value="ne">Nepali</option>
            <option value="no">Norwegian</option>
            <option value="ps">Pashto</option>
            <option value="fa">Persian</option>
            <option value="pl">Polish</option>
            <option value="pt">Portuguese</option>
            <option value="pa">Punjabi</option>
            <option value="ro">Romanian</option>
            <option value="ru">Russian</option>
            <option value="sm">Samoan</option>
            <option value="gd">Scots Gaelic</option>
            <option value="sr">Serbian</option>
            <option value="st">Sesotho</option>
            <option value="sn">Shona</option>
            <option value="sd">Sindhi</option>
            <option value="si">Sinhala</option>
            <option value="sk">Slovak</option>
            <option value="sl">Slovenian</option>
            <option value="so">Somali</option>
            <option value="es">Spanish</option>
            <option value="su">Sundanese</option>
            <option value="sw">Swahili</option>
            <option value="sv">Swedish</option>
            <option value="tg">Tajik</option>
            <option value="ta">Tamil</option>
            <option value="te">Telugu</option>
            <option value="th">Thai</option>
            <option value="tr">Turkish</option>
            <option value="uk">Ukrainian</option>
            <option value="ur">Urdu</option>
            <option value="uz">Uzbek</option>
            <option value="vi">Vietnamese</option>
            <option value="cy">Welsh</option>
            <option value="xh">Xhosa</option>
            <option value="yi">Yiddish</option>
            <option value="yo">Yoruba</option>
            <option value="zu">Zulu</option>
          </select>

        Powered by <span style="white-space: nowrap;"><a class="goog-logo-link" href="https://translate.google.com" target="_blank"><img style="padding-right: 3px;" src="https://www.google.com/images/logos/google_logo_41.png" width="37" height="13">Translate</a></span>
      </div>

          <div id="tweetFeed"></div>

        </div>
        <div class="col-md-7">
          <h4>Saved Tweets</h4>
          <div style="border:1px dashed blue; height:200px; width:500px;" ondrop="dropSaveTweet(event)" ondragover="allowDrop(event)"><p style="padding-left:160px;padding-top:90px;">Drag Tweets Here to Save</p> </div>
          <div id="savedTweets" style="height:45vh;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
    <div id="contacts" class="tab-pane fade">
      <div class="row">
        <div class="col-md-12" >
          <h4>Contacts</h4>
          <div class="form-group" >
            <label for="inputContactType" style="text-transform:uppercase;">Category</label>
            <select class="form-control" style="color:black;" id="inputContactType" >
              <option value="" selected>(no category filtering)</option>
              <option value="Current MSF Staff">Current MSF Staff</option>
              <option value="Supplier">Supplier</option>
              <option value="United Nations">United Nations</option>
              <option value="Government">Government</option>
              <option value="Other NGO">Other NGO</option>
              <option value="Academic">Academic</option>
              <option value="Private Medical Practice">Private Medical Practice</option>
            </select>
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="contSearchTerm" name="" value="" placeholder="Search by typing Name, Phone, Email, etc. ... ..."><br />
            <!--<table><tr><td>
            <input type="radio" id="radio_msf_peer"
             name="msf_relationship" value="msf_peer">
            <label for="radio_msf_peer">MSF Peers only</label></td><td>
            <input type="radio" id="radio_msf_associate"
             name="msf_relationship" value="msf_associate">
            <label for="msf_associate">MSF Associates only</label></td></tr></table>-->
          </div>
          <div id="contactsContainer" style="height:70vh;overflow:auto;"></div>
        </div>
      </div>
    </div>
    <div id="missions" class="tab-pane fade">
      <div class="row">
        <div class="col-md-12" >
          <h4>Missions</h4>
          <div class="form-group">
            <input type="text" class="form-control" id="missSearchTerm" name="" value="" placeholder="Term for searching name, region, severity or capacity ...">
          </div>
          <div id="missionsContainer"></div>
        </div>
      </div>
    </div>
    <div id="ongoingEvents" class="tab-pane fade">
      <div class="row">
        <div class="col-md-12" >
          <h4>Ongoing MSF Projects in the same country</h4>
          <div id ="ongoingEventsContainer" style="height:70vh;"></div>
        </div>
      </div>
    </div>
    <div id="reports" class="tab-pane fade">
      <div class="row">
        <div class="col-md-6" >
          <h4>Reports</h4>
          <div id="reportsContainer" style="height:70vh;"></div>
        </div>
      </div>
    </div>
    <div id="countryDetails" class="tab-pane fade">
      <div class="row">
        <div class="col-md-6" >
          <h4>Country details</h4>
          <div id="countryDetailsContainer" style="height:70vh;">(work on this tab in progress)</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Map -->
<div id="mapContainer" class="col-md-6">
  <div class="row bottom-margined">
      <div class="col-sm-12">
        <input type="text" class="form-control" placeholder="Search address/location..." id="eventAddress">
      </div>
  </div>
  <div class="row bottom-margined">
    <div class="col-sm-4">
      <label for="mapAddressLat">OR locate by coordinates:</label>
    </div>
    <div class="col-sm-3">
      <input type="text" class="form-control" value="" id="eventAddressLat" placeholder="Latitude">
    </div>
    <div class="col-sm-3">
      <input type="text" class="form-control" value="" id="eventAddressLng" placeholder="Longitude">
    </div>
    <div class="col-sm-2">
      <button type="button" class="btn btn-info btn-sm" id="eventAddressLocate"><span class="glyphicon glyphicon-search"></span></button>
    </div>
  </div>
  <div id="map"></div>
</div>
</div> <!-- Row -->
</div> <!-- container -->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/lib/lodash.min.js"></script>
<script src="/lib/async/async.min.js"></script>
<script src="/lib/moment.min.js"></script>
<script src="/lib/jquery/jquery-3.3.1.min.js"></script>
<script src="/lib/jquery/jquery-ui-1.12.1.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->

<script src="/lib/bootstrap/js/bootstrap.min.js"></script>
<script src="/lib/bootstrap/plugins/datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="/lib/jquery/jquery.flexText.min.js"></script>
<script src="/lib/jquery/jquery.validate.js"></script>
<!-- Cookies -->
<script src="/lib/cookie/js.cookie-2.2.0.min.js"></script>
<!--Twitter-->
<script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<!--Google translate-->
<script src="https://www.google.com/jsapi?key=AIzaSyDRRHBlIoij_c4Lx8IzwY8OpPmVPABC81g"></script>

<script src="/lib/countrySelect.min.js"></script>

<!-- VueJs + plug-ins -->
<script src="/lib/vue/vue.min.js"></script>
<script src="/lib/vue/plugins/vue-bootstrap-datetimepicker.min.js"></script>


<!-- Get query parameter from URL -->
<!-- Ask the server for reports from specific event -->
<!-- Display event details -->
<!-- Display map with points -->
<script src="/lib/getQueryVariable/getQueryVariable.js"></script>
<script src="/lib/leaflet/leaflet.js"></script>
<script src="/lib/leaflet/leaflet.groupedlayercontrol.min.js"></script>

<script src="/lib/leaflet/leaflet.markercluster.js"></script>
<script src="/lib/leaflet/leaflet.rrose.js"></script>


<script src="/resources/js/nav.js"></script>
<script src="/resources/js/dragdrop.js"></script>
<script src="/resources/js/twitter.js"></script>

<script src="/resources/js/new-report.js"></script>
<script src="/report/reportcard.js"></script>
<script src="/resources/js/address-autocomplete.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDRRHBlIoij_c4Lx8IzwY8OpPmVPABC81g&libraries=places&callback=initGoogle" async defer></script>

<script type="text/javascript" src="/resources/js/common.js"></script>
<script src="/resources/js/healthsites.js"></script>

<!-- events common variables -->
<script src="/events/common.js"></script>
<script src="/resources/js/events.js"></script>

<script src="/resources/js/contacts.js"></script>
<script src="/resources/js/missions.js"></script>
<script>

var mapOn = 1;

$('#feedTab').on('click', function(e){
  //$('#mapContainer').removeClass('col-md-8');
  if (mapOn === 1){
    $('#mapContainer').toggle();
    $('#sidepane').removeClass('col-md-6');
    $('#sidepane').addClass('col-md-12');
    mapOn = 0;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#contactsTab').on('click', function(e){
  //$('#mapContainer').removeClass('col-md-8');
  if (mapOn === 0) {
    $('#mapContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#missionsTab').on('click', function(e){
  //$('#mapContainer').removeClass('col-md-8');
  if (mapOn === 0) {
    $('#mapContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#eventTab').on('click', function(e){
  if (mapOn === 0) {
    $('#mapContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#ongoingEventsTab').on('click', function(e){
  if (mapOn === 0) {
    $('#mapContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#reportsTab').on('click', function(e){
  if (mapOn === 0) {
    $('#reportsContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});

$('#countryDetailsTab').on('click', function(e){
  //$('#mapContainer').removeClass('col-md-8');
  if (mapOn === 0) {
    $('#mapContainer').toggle();
    $('#mapContainer').addClass('col-md-6');
    $('#sidepane').removeClass('col-md-12');
    $('#sidepane').addClass('col-md-6');
    mapOn = 1;
    setTimeout(function(){mainMap.invalidateSize()}, 400);
  }
});


var currentContactId = 0;
var onContactLinkClick = function(id) {
  $('#privateContactDiv').toggle(localStorage.getItem('username')!=null);
  $('#shareWithDiv').toggle(localStorage.getItem('username')!=null);
  $('#contactDetailsModal').on('shown.bs.modal');
  currentContactId = id;
  getContact(id);
};

var contactInfo = {};
var convertToLocaleDate= function (isoDate) {
  if (isoDate)
  return (new Date(isoDate)).toLocaleString();
  else
  return '';
}
var getContact = function(id) {
  $.getJSON("/api/contacts/" + id, function(contact) {
    contactInfo = contact.result ? contact.result.properties : {};
    //$('#contactDetailsModal').find('div.form-group').hide();
    $("span.private").html(
    '<select id="privateContact">'+
      '<option value="true">yes</option>' +
      '<option value="false">no</option>' +
    '</select>'
    );
    $('#privateContact').val(contact.result.private);

    $("span.filed").html(convertToLocaleDate(contact.result.created_at));
    $("span.updated").html(convertToLocaleDate(contact.result.updated_at));
    $("span.last_email").html(convertToLocaleDate(contact.result.last_email_sent_at));

    contact.result.properties.msf_peer = contact.result.properties.msf_peer ? 'yes' : 'no';
    contact.result.properties.msf_associate = contact.result.properties.msf_associate ? 'yes' : 'no';

    // if web address
    if (contact.result.properties.web) {
      // prepend http:// to web (don't assume https, assume redirection)
      if (!contact.result.properties.web.startsWith('http')) {
        contact.result.properties.web = 'http://' + contact.result.properties.web;
      }
      // make it a link
      contact.result.properties.web = '<a href="'+contact.result.properties.web + '">'+contact.result.properties.web+'</a>';
    }

    // also hyperlink emails
    if (contact.result.properties.email) {
      contact.result.properties.email = '<a href="'+contact.result.properties.email + '">'+contact.result.properties.email+'</a>'
    }
    if (contact.result.properties.email2) {
      contact.result.properties.email2 = '<a href="'+contact.result.properties.email2 + '">'+contact.result.properties.email2+'</a>'
    }

    _(contact.result.properties).forIn(function(value, key) {
      // console.log("Key:", key, "Value", value);
      $("span." + key).html(value);
      $("span." + key).parent().toggle(!!(value));

    });
    if (contact.result.properties.type === 'Current MSF Staff') {
      $("#msf_details").show();
      $("#employment_details").hide();
    } else {
      $("#msf_details").hide();
      $("#employment_details").show();
    }
  }).fail(function(err) {
    if (err.responseText.includes('expired')) {
      alert("session expired");
    } else {
      // Catch condition where no data returned
      alert('error: ' + err.responseText);
    }
  });
};

$('#sharewith_email').keyup(function(event){
    if(event.keyCode == 13){
        var email = $('#sharewith_email').val();
        var url = 'https://graph.microsoft.com/v1.0/users/'+email;
        $.getJSON(url, function(data) {
            $.ajax({
                type: "PATCH",
                url: "/api/contacts/" + currentContactId + "/share",
                data: JSON.stringify({"oid":data.id}),
                contentType: 'application/json'
            }).done(function(data, textStatus, req) {
                alert("shared");
                $('#sharewith_email').val();
            }).fail(function(err) {
                if (err.responseText.includes('expired')) {
                    alert("session expired");
                  }
            });
        }).fail(function(err) {
            alert("MSF user not found, check email address");
        });
    }
});

$('#privateContact').change(function() {
    $.ajax({
      type: 'PATCH',
      url: '/api/contacts' + currentContactId + "/private",
      data: JSON.stringify({"private": this.value})
      contentType: 'application/json'
    }).fail(function(err) {
        alert('privacy not set due to error');
    });
});
</script>

</body>
</html>
